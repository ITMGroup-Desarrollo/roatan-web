---
import { translations } from "../../locales.js";
const lang = Astro.props?.lang ?? "es";
const t = translations[lang] ?? translations["es"];
import { Image } from "astro:assets";
import "aos/dist/aos.css";
import olas from "../../assets/img/iconos/port-experience/ola.png";
import ave from "../../assets/img/iconos/port-experience/ave.png";
import chica from "../../assets/img/iconos/port-experience/chica.png";
import WaveObserver from "../js/WaveObserver";

import "../../assets/css/home.css";
---

<div
  id="port-experience-welcome"
  class="welcome-container w-screen h-auto md:h-[42rem] xl:h-[48rem] flex flex-col md:flex-row justify-center relative overflow-hidden bg-white z-0"
>
  <div class="images-container absolute h-full w-screen flex flex-row">
    <Image
      class="hidden md:block chica parallax-image absolute w-32 md:w-60 lg:w-72 xl:w-80 h-auto bottom-5 md:bottom-20 z-0 animate-in"
      src={chica}
      alt="logo"
      loading="eager"
      data-speed="0.5"
    />
    <Image
      class="hidden md:block ave parallax-image absolute w-20 md:w-60 lg:w-64 xl:w-80 h-auto right-0 bottom-10 z-0 animate-in"
      src={ave}
      alt="logo"
      loading="eager"
      data-speed="0.6"
    />
  </div>
  <div
    class="text-container parallax-text w-full px-5 md:px-0 mx-auto md:mx-0 text-center mt-16 mb-5 md:mt-5 md:mb-0 lg:w-4/5 md:pt-7 xl:pt-24 flex flex-col"
    data-speed="0.3"
  >
    <p
      class="text-5xl md:text-5xl xl:text-7xl self-center lg:mt-10 font-bebas text-[var(--secondary-color)]"
    >
      {t.port.title}
    </p>
    <div
      class="w-12 md:w-16 self-center border-b-2 md:border-b-4 border-[var(--primary-color)] my-2"
    >
    </div>
    <p
      class="text-2xl px-4 md:px-0 text-justify md:text-center self-start md:self-center text-black md:w-2/3"
    >
      {t.port.text}
    </p>
  </div>
  <div
    class="wave-container parallax-image w-full h-[24%] bottom-5 right-0 bg-transparent md:absolute z-1 overflow-hidden"
    data-speed="0.4"
  >
    <Image
      class="wave w-[100%] h-[100%] right-0 top-0 object-fill"
      src={olas}
      alt="logo"
      loading="eager"
    />
    <div class="wave-cover md:shrink"></div>
  </div>
  <WaveObserver client:visible />
</div>

<script is:inline>
  document.addEventListener("DOMContentLoaded", () => {
    const parallaxElements = document.querySelectorAll(
      ".parallax-image, .parallax-text",
    );

    if (parallaxElements.length === 0) return;

    const startOffset = 500;

    // Función para verificar si estamos en mobile
    const isMobile = () => window.innerWidth < 768; // 768px es el breakpoint md de Tailwind

    const handleScroll = () => {
      // Si es mobile, no aplicar parallax
      if (isMobile()) {
        parallaxElements.forEach((element) => {
          element.style.transform = "";
        });
        return;
      }

      const scrolled = window.scrollY;

      if (scrolled > startOffset) {
        const adjustedScroll = scrolled - startOffset;

        parallaxElements.forEach((element) => {
          const speed = parseFloat(element.getAttribute("data-speed")) || 0.5;
          const yPos = -(adjustedScroll * speed);

          element.style.transform = `translateY(${yPos}px)`;
        });
      } else {
        parallaxElements.forEach((element) => {
          element.style.transform = `translateY(0px)`;
        });
      }
    };

    let ticking = false;

    window.addEventListener("scroll", () => {
      if (!ticking) {
        window.requestAnimationFrame(() => {
          handleScroll();
          ticking = false;
        });
        ticking = true;
      }
    });

    // Verificar también cuando se redimensiona la ventana
    window.addEventListener("resize", () => {
      if (!ticking) {
        window.requestAnimationFrame(() => {
          handleScroll();
          ticking = false;
        });
        ticking = true;
      }
    });

    // Ejecutar una vez al cargar para aplicar o no el efecto
    handleScroll();
  });
</script>

<style>
  /* Solo aplicar estilos parallax en desktop */
  @media (min-width: 768px) {
    .parallax-image,
    .parallax-text {
      will-change: transform;
      transition: transform 0.5s ease-out;
    }
  }
</style>
