---
import { translations } from "../../locales.js";
const lang = Astro.props?.lang ?? "es";
const t = translations[lang] ?? translations["es"];
import { Image } from "astro:assets";
import "aos/dist/aos.css";
import olas from "../../assets/img/iconos/home/olas-blue.png";
import ave from "../../assets/img/iconos/home/ave.png";
import chica from "../../assets/img/iconos/home/chica.png";
import WaveObserver from "../../components/js/WaveObserver.jsx";
import WaveObserverPort from "../../components/js/WaveObserverPort.jsx";
import "../../assets/css/home.css";
---

<div
  class="welcome-container w-screen h-[48rem] md:h-[36rem] flex items-center justify-center relative overflow-hidden bg-white"
>
  <WaveObserver client:visible />
  <div class="images-container absolute h-full w-screen flex flex-row">
    <Image
      class="hidden md:block chica absolute w-20 md:w-60 lg:w-80 h-auto bottom-0 z-0"
      src={chica}
      alt="logo"
      loading="eager"
      data-speed="0.4"
    />

    <Image
      class="ave parallax-image absolute w-28 md:w-60 lg:w-64 h-auto right-5 md:right-20 lg:right-36 xl:right-1/5 top-0 md:top-20 lg:top-[8rem] z-10"
      src={ave}
      alt="logo"
      loading="eager"
      data-speed="0.6"
    />
  </div>
  <div
    class="text-container parallax-text w-full px-5 md:px-0 mt-6 md:mt-36 lg:w-1/2 text-center flex flex-col lg:block pb-8"
    data-speed="0.25"
  >
    <h1>
      <p class="text-2xl md:text-4xl font-bebas text-[var(--secondary-color)]">
        {t.homeWelcome.title}
      </p>
      <p
        class="text-3xl flex mb-5 flex-col md:text-7xl font-bebasBold text-[var(--primary-color)]"
      >
        {t.homeWelcome.subtitle}
      </p>
    </h1>
    <div
      class="w-16 mx-auto border-b-4 lg:mb-5 border-[var(--primary-color)] mb-4"
    >
    </div>
    <p class="text-2xl md:text-2xl text-justify px-4 md:text-center text-black">
      {t.homeWelcome.text}
    </p>
  </div>
  <div
    class="wave-container parallax-image w-[18%] h-[10%] md:w-[24%] md:h-[15%] lg:w-[28%] xl:w-[20%] xl:mb-5 top-20 md:mb-0 md:top-[12rem] right-0 bg-white absolute z-1 overflow-hidden"
  >
    <Image
      class="wave absolute w-[100%] h-[100%] right-0 top-0 object-fill"
      src={olas}
      alt="logo"
      loading="eager"
    />
    <div class="wave-cover md:shrink"></div>
  </div>
  <WaveObserverPort client:visible />
</div>
<script is:inline>
  document.addEventListener("DOMContentLoaded", () => {
    // ❌ No parallax en mobile
    if (!window.matchMedia("(min-width: 768px)").matches) return;

    const section = document.querySelector(".welcome-container");
    if (!section) return;

    const parallaxElements = section.querySelectorAll(
      ".parallax-image, .parallax-text",
    );

    if (parallaxElements.length === 0) return;

    let isActive = false;

    // Activar solo cuando la sección esté visible
    const observer = new IntersectionObserver(
      ([entry]) => {
        isActive = entry.isIntersecting;
      },
      { threshold: 0.1 },
    );

    observer.observe(section);

    const maxTranslate = 120;

    const handleScroll = () => {
      if (!isActive) return;

      const scrolled = window.scrollY;
      const startOffset = section.offsetTop - window.innerHeight * 0.6;

      const adjustedScroll = scrolled - startOffset;
      if (adjustedScroll < 0) return;

      parallaxElements.forEach((el) => {
        const speed = parseFloat(el.dataset.speed) || 0.4;

        const yPos = Math.max(
          Math.min(-(adjustedScroll * speed), maxTranslate),
          -maxTranslate,
        );

        el.style.transform = `translateY(${yPos}px)`;
      });
    };

    let ticking = false;

    window.addEventListener("scroll", () => {
      if (!ticking) {
        requestAnimationFrame(() => {
          handleScroll();
          ticking = false;
        });
        ticking = true;
      }
    });
  });
</script>
<style>
  /* Solo aplicar estilos parallax en desktop */
  @media (min-width: 768px) {
    .parallax-image,
    .parallax-text {
      will-change: transform;
      transition: transform 0.5s ease-out;
    }
  }
</style>
