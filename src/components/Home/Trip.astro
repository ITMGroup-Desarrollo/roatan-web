---
import { translations } from "../../locales.js";
const lang = Astro.props?.lang ?? "es";
const t = translations[lang] ?? translations["es"];
import { Image } from "astro:assets";
import trip from "../../assets/img/iconos/home/tripadvisor.png";
import cocktel from "../../assets/img/iconos/home/cocktel.png";
import platanitos from "../../assets/img/iconos/home/platanitos.png";
import palmita from "../../assets/img/iconos/home/palmita.png";
import planta from "../../assets/img/iconos/home/planta.png";
import "aos/dist/aos.css";
import SwiperClient from "../../components/js/SwiperClientTrip";
import WaveObserverTrip from "../../components/js/WaveObserverTrip";
---

<div
  class="trip-container w-screen h-[40rem] lg:h-[48rem] flex flex-col items-center justify-center relative overflow-y-hidden overflow-x-hidden bg-[var(--redSocial-color)]"
>
  <div
    class="platanito-trip absolute top-30 left-0 md:bottom-10 w-48 md:w-96 h-auto"
  >
    <!-- Palmita (atrás) -->
    <Image
      class="absolute bottom-[-8rem] translate-x-[-4rem] md:bottom-[-4rem] left-0 h-[600px] md:h-[900px] rotate-12 z-0"
      src={palmita}
      alt="palmita"
      loading="eager"
    />

    <!-- Platanitos (adelante) -->
    <Image
      class="absolute parallax-image bottom-0 left-[-4rem] md:h-[600px] w-[800px] z-10"
      src={platanitos}
      alt="platanitos"
      loading="eager"
    />
  </div>
  <div class="logo-trip-container w-full flex justify-center z-10">
    <WaveObserverTrip client:visible />
    <Image
      class="w-24 md:w-36 h-auto z-10"
      src={trip}
      alt="logo-tripadvisor"
      loading="eager"
    />
  </div>
  <div
    class="swiper-container z-10 w-full lg:w-3/4 h-[26rem] lg:h-full overflow-hidden"
  >
    <SwiperClient client:visible />
  </div>

  <div
    class="cocktel-trip absolute bottom-0 md:bottom-0 right-0 w-48 md:w-80 h-auto"
  >
    <!-- Planta (atrás) -->
    <Image
      class="absolute bottom-0 right-[-4rem] md:h-[800px] h-[600px] z-0"
      src={planta}
      alt="planta"
      loading="eager"
      data-speed="0.3"
    />

    <!-- Cocktel (adelante) -->
    <Image
      class="absolute bottom-20 right-0 w-full h-auto z-10 parallax-image"
      src={cocktel}
      alt="cocktel"
      loading="eager"
      data-speed="0.5"
    />
  </div>
</div>
<script is:inline>
  document.addEventListener("DOMContentLoaded", () => {
    // ❌ No parallax en mobile
    if (!window.matchMedia("(min-width: 768px)").matches) return;

    const section = document.querySelector(".trip-container");
    if (!section) return;

    const parallaxElements = section.querySelectorAll(".parallax-image");
    if (parallaxElements.length === 0) return;

    let isActive = false;

    const observer = new IntersectionObserver(
      ([entry]) => {
        isActive = entry.isIntersecting;
      },
      { threshold: 0.1 },
    );

    observer.observe(section);

    const maxTranslate = 90;

    const handleScroll = () => {
      if (!isActive) return;

      const scrolled = window.scrollY;
      const startOffset = section.offsetTop - window.innerHeight * 0.3;

      const adjustedScroll = scrolled - startOffset;
      if (adjustedScroll < 0) return;

      parallaxElements.forEach((el) => {
        const speed = parseFloat(el.dataset.speed) || 0.4;

        const yPos = Math.max(
          Math.min(-(adjustedScroll * speed), maxTranslate),
          -maxTranslate,
        );

        el.style.transform = `translateY(${yPos}px)`;
      });
    };

    let ticking = false;

    window.addEventListener("scroll", () => {
      if (!ticking) {
        requestAnimationFrame(() => {
          handleScroll();
          ticking = false;
        });
        ticking = true;
      }
    });
  });
</script>
<style>
  /* Solo aplicar estilos parallax en desktop */
  @media (min-width: 768px) {
    .parallax-image,
    .parallax-text {
      will-change: transform;
      transition: transform 0.5s ease-out;
    }
  }
</style>
